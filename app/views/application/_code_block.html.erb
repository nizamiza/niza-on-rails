<% lang = local_assigns.fetch(:lang, "plaintext") %>
<% with_copy_button = local_assigns.fetch(:with_copy_button, true) %>
<% content = yield %>

<code>
  <pre
    class="code-block"
    data-lang="<%= lang %>"
    data-content='<%= content %>'
  ></pre>
  <% if with_copy_button %>
    <%= render "application/copy_button", text: content.to_s  %>
  <% end %>
</code>

<% content_for_head_once "code-block" do %>
  <%= stylesheet_link_tag "code-highlight" %>
  <%= javascript_include_tag "code-highlight", type: "module" %>
  <style>
    .code-block {
      &:empty:after {
        content: attr(data-content);
      }
    }
  </style>
<% end %>
